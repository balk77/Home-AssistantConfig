- id: thermostaat_3
  alias: Thermostaat 3
  trigger:
  - platform: time
    at: '2:00:00'
  condition:
    - condition: state
      entity_id: input_boolean.huis_slaapstand
      state: 'off'
  action:
  - service: ifttt.trigger
    data:
      event: SetTemp
      value1: 15
  - service: input_number.set_value
    data_template:
      entity_id: input_number.iftt_temp_triggered_sp
      value: 15
  - delay: 00:00:01
  - service: input_boolean.turn_on
    entity_id: input_boolean.iftt_temp_triggered
  - service: input_boolean.turn_on
    entity_id: input_boolean.huis_slaapstand
- id: occupancy_sim_on
  alias: Simulate Occupancy - on
  trigger:
  - platform: state
    entity_id: input_boolean.occupancy_simulation
    to: 'on'
  action:
    service: script.turn_on
    entity_id: script.woonkamer_low
- id: occupancy_sim_off
  alias: occupancy_sim_off
  trigger:
  - platform: state
    entity_id: sensor.wk_multisensor_burglar
    to: '8'
  - platform: state
    entity_id: sensor.wk_multisensor_burglar
    to: '3'
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.occupancy_simulation
- id: occupancy_sim_goodnight
  alias: occupancy_sim_goodnight
  trigger:
    platform: time
    at: '22:30'
  condition:
    - condition: state
      entity_id: input_boolean.occupancy_simulation
      state: 'on'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.occupancy_simulation
  - service: light.turn_off
    entity_id: group.woonkamer
  - service: switch.turn_off
    entity_id: group.woonkamer
  - service: notify.telegram
    data:
      # target: device/Nexus5X
      message: Lampen in huis gaan uit
- id: reset_huis_slaapstand
  alias: Reset huis_slaapstand
  trigger:
    platform: time
    at: 04:00:00
  action:
    service: input_boolean.turn_off
    entity_id: input_boolean.huis_slaapstand
- id: set_huis_slaapstand
  alias: Set huis_slaapstand
  trigger:
    platform: state
    entity_id: group.woonkamer
    to: 'off'
  condition:
    condition: or
    conditions:
    - condition: time
      after: '21:00:00'
    - condition: time
      before: '4:00:00'
  action:
    service: input_boolean.turn_on
    entity_id: input_boolean.huis_slaapstand
- id: notify_when_not_home_1
  alias: Notify and activate Occupancy Simulation 1
  trigger:
  - platform: time
    at: '18:10:00'
  condition:
    - condition: and
      conditions:
      - condition: sun
        after: sunset
      - condition: state
        entity_id: group.woonkamer
        state: 'off'
  action:
  - service: notify.telegram
    data:
      # target: device/Nexus5X
      message: Lampen in huis gaan aan - aanwezigheidssimulatie
  - service: input_boolean.turn_on
    entity_id: input_boolean.occupancy_simulation
- id: notify_when_not_home_2
  alias: Notify and activate Occupancy Simulation 2
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: and
    conditions:
    - condition: time
      after: '18:10:00'
    - condition: state
      entity_id: group.woonkamer
      state: 'off'
    - condition: time
      before: '22:30:00'
  action:
  - service: notify.telegram
    data:
      # target: device/Nexus5X
      message: Lampen in huis gaan aan - aanwezigheidssimulatie
  - service: input_boolean.turn_on
    entity_id: input_boolean.occupancy_simulation
- id: vals_woonkamer_on
  alias: Detect vals aantal lampen aan in woonkamer
  trigger:
  - entity_id: sensor.wk_multisensor_burglar
    platform: state
    to: '0'
    for:
      minutes: 60
  condition:
    - condition: and
      conditions:
      - condition: time
        after: '22:00:00'
      - condition: template
        value_template: '{{ states.sensor.woonkamer_number_of_lights_on.state | int
          <= 2  }}'
  action:
  - service: script.turn_on
    entity_id: script.woonkamer_off
  - service: input_boolean.turn_on
    entity_id: input_boolean.huis_slaapstand
- id: back_from_vacation
  alias: Terug van Vakantie
  trigger:
  - entity_id: device_tracker.phone_sander
    platform: state
    to: home
  condition:
    condition: state
    entity_id: input_boolean.vakantie
    state: 'on'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.vakantie
- id: disable_cv_ketel
  alias: Zet thermostaat van klokprogramma af en op 15oC
  trigger:
    platform: event
    event_type: zwave.scene_activated
    event_data:
      entity_id: zwave.keuken_koof
      scene_id: 14
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.nefit_disable_clock_mode

- id: enable_cv_ketel
  alias: Zet thermostaat op klokprogramma
  trigger:
  - platform: mqtt
    topic: keuken_aanrecht_rechts/binary_sensor/pir_sensor_keuken/state
    payload: 'ON'
  - entity_id: sensor.wk_multisensor_burglar
    platform: state
    to: '8'
  - entity_id: sensor.wk_multisensor_burglar
    platform: state
    to: '3'
  condition:
    - condition: template
      # is de boolean binnen de afgelopen 600 seconden geschakeld? Dan "FALSE"
      value_template: '{{as_timestamp(now()) - as_timestamp(states.input_boolean.nefit_disable_clock_mode.last_changed) > 600 }}'

  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.nefit_disable_clock_mode